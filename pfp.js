var l = ['13','27','33','39','40','41','50','52','65','70','71','80','87','93','104','113','131','139','153','154','180','207','216','227','230','233','238','247','251','256','258','270','285','296','316','358','366','372','378','379','390','400','405','408','421','435','468','470','478','516','517','553','565','574','584','594','606','630','641','652','679','709','723','724','725','734','735','738','747','757','785','791','804','820','826','831','832','833','836','842','852','868','875','898','918','926','937','942','945','946','961','967','970','971','972','983','985','990','991','996','1032','1034','1036','1039','1042','1071','1073','1089','1097','1149','1156','1176','1191','1201','1203','1220','1232','1244','1255','1258','1261','1278','1281','1291','1296','1297','1307','1323','1327','1328','1349','1359','1381','1395','1404','1406','1430','1439','1448','1451','1453','1454','1471','1478','1483','1488','1497','1517','1520','1521','1530','1540','1550','1552','1559','1562','1564','1566','1580','1593','1595','1598','1619','1627','1629','1630','1640','1645','1658','1693','1709','1735','1747','1760','1774','1775','1778','1779','1793','1801','1814','1827','1836','1875','1910','1912','1934','1939','1940','1943','1949','1957','1963','1971','1996','1998','1999','2005','2014','2015','2030','2031','2032','2034','2038','2051','2060','2062','2090','2095','2117','2118','2148','2151','2159','2163','2174','2189','2192','2212','2221','2224','2227','2241','2253','2261','2263','2268','2285','2286','2294','2301','2316','2318','2319','2323','2334','2339','2346','2349','2350','2352','2364','2365','2372','2387','2393','2399','2416','2418','2427','2439','2446','2448','2452','2467','2473','2474','2477','2484','2492','2500','2507','2509','2517','2529','2536','2540','2558','2561','2568','2569','2578','2581','2603','2616','2645','2648','2676','2686','2694','2697','2711','2725','2728','2737','2744','2773','2783','2786','2824','2825','2828','2835','2839','2849','2856','2867','2872','2891','2892','2896','2898','2927','2935','2941','2951','2975','2979','2982','2998','2999','3002','3004','3018','3021','3023','3036','3048','3050','3060','3063','3067','3070','3093','3095','3110','3115','3126','3133','3144','3145','3150','3151','3155','3164','3165','3171','3175','3177','3198','3210','3214','3226','3228','3230','3231','3232','3253','3264','3274','3277','3279','3301','3313','3315','3332','3349','3375','3376','3387','3401','3404','3408','3417','3419','3425','3450','3452','3461','3474','3477','3487','3488','3491','3515','3525','3538','3541','3549','3551','3566','3573','3576','3583','3606','3616','3619','3628','3636','3637','3643','3732','3771','3805','3834','3851','3865','3866','3876','3885','3902','3904','3905','3927','3930','3933','3946','3952','3967','3973','3998','4006','4023','4057','4060','4063','4065','4072','4081','4083','4108','4115','4121','4134','4158','4163','4179','4190','4196','4200','4217','4218','4239','4245','4265','4271','4288','4301','4307','4349','4366','4368','4371','4377','4401','4414','4417','4443','4444','4445','4455','4457','4480','4482','4487','4489','4497','4520','4521','4540','4548','4560','4563','4565','4572','4581','4583','4585','4589','4590','4608','4630','4637','4643','4644','4654','4662','4669','4672','4676','4688','4703','4714','4753','4771','4794','4801','4809','4851','4897','4917','4931','4946','4959','4970','4972','4979','4980','4983','4997','4998','5008','5015','5022','5037','5066','5072','5075','5089','5094','5099','5110','5115','5131','5136','5137','5148','5158','5163','5212','5213','5233','5271','5283','5294','5296','5303','5305','5306','5311','5312','5364','5376','5381','5382','5387','5423','5425','5430','5441','5447','5458','5468','5470','5481','5498','5507','5527','5541','5568','5583','5596','5604','5610','5614','5615','5618','5620','5640','5647','5655','5662','5710','5711','5720','5729','5742','5772','5797','5818','5847','5849','5850','5853','5859','5883','5886','5887','5902','5915','5918','5947','5952','5961','5981','5987','5991','6005','6014','6019','6054','6055','6071','6085','6097','6102','6105','6107','6123','6146','6150','6159','6176','6190','6193','6194','6199','6207','6220','6229','6247','6252','6299','6303','6307','6310','6320','6328','6335','6337','6345','6365','6373','6380','6387','6395','6397','6414','6448','6453','6473','6481','6492','6527','6534','6536','6539','6544','6551','6566','6577','6595','6603','6605','6611','6614','6623','6634','6636','6638','6649','6671','6673','6686','6687','6696','6715','6722','6726','6729','6730','6732','6740','6766','6767','6772','6786','6799','6804','6828','6839','6873','6881','6891','6903','6936','6967','6970','6973','6978','6979','7018','7021','7028','7041','7066','7067','7072','7074','7080','7096','7108','7115','7117','7129','7142','7144','7147','7154','7170','7179','7206','7219','7229','7237','7240','7253','7286','7287','7288','7292','7296','7297','7298','7299','7304','7314','7320','7335','7360','7366','7371','7389','7394','7419','7425','7430','7432','7433','7451','7455','7464','7467','7480','7492','7500','7501','7516','7526','7536','7551','7557','7561','7563','7578','7582','7596','7603','7615','7618','7622','7623','7631','7645','7654','7665','7684','7708','7724','7732','7735','7737','7751','7796','7798','7806','7814','7819','7835','7843','7861','7867','7880','7883','7885','7895','7896','7901','7902','7918','7924','7943','7976','7977','7983','7984','7988','8000','8005','8014','8021','8025','8027','8029','8037','8075','8098','8100','8101','8111','8117','8128','8130','8134','8147','8160','8177','8195','8224','8242','8246','8251','8272','8294','8296','8325','8341','8348','8349','8361','8370','8387','8402','8403','8418','8431','8433','8435','8442','8447','8448','8450','8457','8463','8475','8495','8513','8514','8517','8525','8531','8536','8546','8550','8583','8585','8587','8594','8600','8625','8636','8640','8645','8654','8655','8663','8664','8692','8699','8710','8719','8723','8733','8734','8760','8772','8783','8784','8785','8791','8793','8800','8805','8812','8818','8839','8859','8860','8864','8883','8907','8913','8922','8924','8930','8961','8967','8972','8973','8991','8993','8994','9003','9007','9013','9021','9022','9036','9038','9069','9070','9075','9085','9087','9094','9099','9104','9109','9112','9121','9126','9171','9184','9202','9208','9218','9236','9238','9241','9260','9265','9289','9292','9294','9299','9312','9325','9330','9332','9343','9344','9345','9388','9389','9390','9402','9408','9414','9415','9418','9436','9445','9451','9452','9454','9459','9460','9467','9494','9532','9552','9561','9562','9575','9583','9587','9592','9597','9610','9621','9651','9652','9699','9708','9710','9721','9724','9725','9730','9736','9737','9738','9741','9743','9746','9748','9750','9767','9792','9802','9803','9804','9829','9830','9844','9858','9886','9889','9893','9900','9911','9912','9920','9936','9947','9964','9970','9971','9977','9985','9988','9995','9997'];

//background
$('#v1,#v2,#v3,#cp').change(function() {
	var selected = [];
	$('.inputs input:checked').each(function() {
	    selected.push($(this).attr('name'));
	});
	var selected = selected.toString();

	if (selected == 'v1,v2,v3,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 25%, rgba(0, 0, 0, 0) 25%), linear-gradient(90deg, #638596 50%, rgba(0, 0, 0, 0) 50%), linear-gradient(90deg, #83deb2 75%, #3c2a3c 75%)');
	}
	else if (selected == 'v2,v3,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #638596 33%, rgba(0, 0, 0, 0) 33%), linear-gradient(90deg, #83deb2 66%, #3c2a3c 66%)');
	}
	else if (selected == 'v1,v3,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 33%, rgba(0, 0, 0, 0) 33%), linear-gradient(90deg, #83deb2 66%, #3c2a3c 66%)');
	}
	else if (selected == 'v1,v2,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 33%, rgba(0, 0, 0, 0) 33%), linear-gradient(90deg, #638596 66%, #3c2a3c 66%)');
	}
	else if (selected == 'v1,v2,v3') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 33%, rgba(0, 0, 0, 0) 33%), linear-gradient(90deg, #638596 66%, #83deb2 66%)');
	}
	else if (selected == 'v3,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #83deb2 50%, #3c2a3c 50%)');
	}
	else if (selected == 'v2,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #638596 50%, #3c2a3c 50%)');
	}
	else if (selected == 'v2,v3') {
		$('#my-phunk').css('background','linear-gradient(90deg, #638596 50%, #83deb2 50%)');
	}
	else if (selected == 'v1,cp') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 50%, #3c2a3c 50%)');
	}
	else if (selected == 'v1,v3') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 50%, #83deb2 50%)');
	}
	else if (selected == 'v1,v2') {
		$('#my-phunk').css('background','linear-gradient(90deg, #a79aff 50%, #638596 50%)');
	}
	else if (selected == 'cp') {
		$('#my-phunk').css('background','#3c2a3c');
	}
	else if (selected == 'v3') {
		$('#my-phunk').css('background','#83deb2');
	}
	else if (selected == 'v2') {
		$('#my-phunk').css('background','#638596');
	}
	else if (selected == 'v1') {
		$('#my-phunk').css('background','#a79aff');
	} 
	else {
	$('#my-phunk').css('background','lightgray');
	};
});

//format img ref
function leadingZeros(input) {
	if (!isNaN(input.value) && input.value.length == 1 && l.includes(input.value)) {
		var pid = '000' + input.value;
		$('#my-phunk').attr('src', `phunk${pid}.svg`);
		$('.warn').css('display', 'none');
	}
	else if (!isNaN(input.value) && input.value.length == 2 && l.includes(input.value)) {
		var pid = '00' + input.value;
		$('#my-phunk').attr('src', `phunk${pid}.svg`);
		$('.warn').css('display', 'none');
	}
	else if (!isNaN(input.value) && input.value.length == 3 && l.includes(input.value)) {
		var pid = '0' + input.value;
		$('#my-phunk').attr('src', `phunk${pid}.svg`);
		$('.warn').css('display', 'none');
	}
	else if (!isNaN(input.value) && input.value.length == 4 && l.includes(input.value)) {
		var pid = input.value;
		$('#my-phunk').attr('src', `phunk${pid}.svg`);		
		$('.warn').css('display', 'none');
	}
	else {
		$('#my-phunk').attr('src', 'philip.png');
		$('.warn').css('display', 'block');
	};
};

//generate pfp
function pfpGen () {
	var selected = [];
	$('.inputs input:checked').each(function() {
	    selected.push($(this).attr('name'));
	});
	var selected = selected.toString();
	var img = document.getElementById('my-phunk');
	const myCanvas = document.getElementById('dl-phunk');
	const originalHeight = myCanvas.height;
	const originalWidth = myCanvas.width;
	render();
	function render() {
	  let dimensions = getObjectFitSize(
	    true,
	    myCanvas.clientWidth,
	    myCanvas.clientHeight,
	    myCanvas.width,
	    myCanvas.height
	  );
	  const dpr = window.devicePixelRatio || 1;
	  myCanvas.width = dimensions.width * dpr;
	  myCanvas.height = dimensions.height * dpr;

	  let ctx = myCanvas.getContext('2d');
	  let ratio = Math.min(
	    myCanvas.clientWidth / originalWidth,
	    myCanvas.clientHeight / originalHeight
	  );
	  var myFill = $('#my-phunk').css('background');
	  ctx.rect(0, 0, myCanvas.width, myCanvas.height);
		if (selected == 'v1,v2,v3,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.25, '#a79aff');
			grd.addColorStop(.25, '#638596');
			grd.addColorStop(.50, '#638596');
			grd.addColorStop(.50, '#83deb2');
			grd.addColorStop(.75, '#83deb2');
			grd.addColorStop(.75, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v2,v3,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#638596');
			grd.addColorStop(.33, '#638596');
			grd.addColorStop(.33, '#83deb2');
			grd.addColorStop(.66, '#83deb2');
			grd.addColorStop(.66, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v1,v3,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.33, '#a79aff');
			grd.addColorStop(.33, '#83deb2');
			grd.addColorStop(.66, '#83deb2');
			grd.addColorStop(.66, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v1,v2,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.33, '#a79aff');
			grd.addColorStop(.33, '#638596');
			grd.addColorStop(.66, '#638596');
			grd.addColorStop(.66, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');	
		}
		else if (selected == 'v1,v2,v3') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.33, '#a79aff');
			grd.addColorStop(.33, '#638596');
			grd.addColorStop(.66, '#638596');
			grd.addColorStop(.66, '#83deb2');
			grd.addColorStop(1, '#83deb2')
		}
		else if (selected == 'v3,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#83deb2');
			grd.addColorStop(.50, '#83deb2');
			grd.addColorStop(.50, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v2,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#638596');
			grd.addColorStop(.50, '#638596');
			grd.addColorStop(.50, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v2,v3') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#638596');
			grd.addColorStop(.50, '#638596');
			grd.addColorStop(.50, '#83deb2');
			grd.addColorStop(1, '#83deb2');
		}
		else if (selected == 'v1,cp') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.50, '#a79aff');
			grd.addColorStop(.50, '#3c2a3c');
			grd.addColorStop(1, '#3c2a3c');
		}
		else if (selected == 'v1,v3') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.50, '#a79aff');
			grd.addColorStop(.50, '#83deb2');
			grd.addColorStop(1, '#83deb2');
		}
		else if (selected == 'v1,v2') {
			var grd = ctx.createLinearGradient(0, 0, myCanvas.width, 0);
			grd.addColorStop(0, '#a79aff');
			grd.addColorStop(.50, '#a79aff');
			grd.addColorStop(.50, '#638596');
			grd.addColorStop(1, '#638596');
		}
		else if (selected == 'cp') {
			var grd = '#3c2a3c';
		}
		else if (selected == 'v3') {
			var grd = '#83deb2';
		}
		else if (selected == 'v2') {
			var grd = '#638596'
		}
		else if (selected == 'v1') {
			var grd = '#a79aff';
		} 
		else {
			var grd = 'lightgray';
		};
	  ctx.fillStyle = grd;
	  ctx.fill();
	  ctx.drawImage(img, 0, 0, myCanvas.width, myCanvas.height);
	};

	function getObjectFitSize(
	  contains /* true = contain, false = cover */,
	  containerWidth,
	  containerHeight,
	  width,
	  height
	) {
	  var doRatio = width / height;
	  var cRatio = containerWidth / containerHeight;
	  var targetWidth = 0;
	  var targetHeight = 0;
	  var test = contains ? doRatio > cRatio : doRatio < cRatio;

	  if (test) {
	    targetWidth = containerWidth;
	    targetHeight = targetWidth / doRatio;
	  } else {
	    targetHeight = containerHeight;
	    targetWidth = targetHeight * doRatio;
	  }

	  return {
	    width: targetWidth,
	    height: targetHeight,
	    x: (containerWidth - targetWidth) / 2,
	    y: (containerHeight - targetHeight) / 2
	  };
	};
	$('#dl-phunk').show();
	dlPhunk();
}

function dlPhunk(){
  var pid = $('#id').val();
  var canvas = document.getElementById('dl-phunk');
  image = canvas.toDataURL("image/png").replace('image/png', 'image/octet-stream');
  var link = document.createElement('a');
  link.download = `phunk${pid}.png`;
  link.href = image;
  link.click();
}
